# cloudbuild file
steps:
    - name: python
      entrypoint: python
      args: ["-m", "pip", "install", "--upgrade", "pip"]     
      
      # install the required packages
    - name: python
      entrypoint: python
      args: ["-m", "pip", "install", "build", "pytest", "Flask", "xlrd", "pandas", "openpyxl", "--user"]
      
      # Execute the main.py file. This will process the xl file, create required files for terraform and place in 'terraform' folder
    - name: python
      entrypoint: python
      args: ["main.py", "--user"]
          
    - id: 'terraformf init'
      name: 'hashicorp/terraform:1.0.0'
      entrypoint: 'sh'
      args:
      - '-c'
      - |
         if [ -d "terraform/" ]; then
        cd terraform
        echo "Initializing ..."
        ls
        cat terraform_commands.txt
        terraform init
      else
        echo "Not available for init"
      fi      
#      args: ['-c', "cd terraform", "terraform init", "cat terraform_commands.txt"]
#      args: ['-c', "cd terraform", "ls"]
